mk_add_options AUTOCLOBBER=1
mk_add_options "export LD_LIBRARY_PATH=$topsrcdir/clang/lib"

CROSS_CCTOOLS_PATH=$topsrcdir/cctools
CROSS_SYSROOT=$topsrcdir/MacOSX10.7.sdk
CROSS_PRIVATE_FRAMEWORKS=$CROSS_SYSROOT/System/Library/PrivateFrameworks
FLAGS="-target x86_64-apple-darwin10 -mlinker-version=136 -B $CROSS_CCTOOLS_PATH/bin -isysroot $CROSS_SYSROOT"

ac_add_options --enable-address-sanitizer
ac_add_options --disable-crashreporter
ac_add_options --enable-debug
ac_add_options --enable-debug-symbols
ac_add_options --disable-install-strip
#ac_add_options --enable-instruments
ac_add_options --disable-jemalloc
ac_add_options --enable-js-shell
ac_add_options --enable-optimize="-O1"
ac_add_options --disable-profiling
ac_add_options --enable-release
ac_add_options --disable-tests
ac_add_options --target=x86_64-apple-darwin
ac_add_options --with-macos-private-frameworks=$CROSS_PRIVATE_FRAMEWORKS

# not sure if these are required.
MOZ_AUTOMATION_L10N_CHECK=0
MOZ_ADDON_SIGNING=${MOZ_ADDON_SIGNING-1}
MOZ_REQUIRE_SIGNING=${MOZ_REQUIRE_SIGNING-0}

# use rust from tooltool
RUSTC="$topsrcdir/rustc/bin/rustc"
CARGO="$topsrcdir/rustc/bin/cargo"

# use clang from tooltool
export CC="$topsrcdir/clang/bin/clang $FLAGS"
export CXX="$topsrcdir/clang/bin/clang++ $FLAGS"
export CPP="$topsrcdir/clang/bin/clang $FLAGS -E"
export LLVM_SYMBOLIZER="$topsrcdir/clang/bin/llvm-symbolizer"
export LLVMCONFIG=$topsrcdir/clang/bin/llvm-config
export LDFLAGS="-Wl,-syslibroot,$CROSS_SYSROOT -Wl,-dead_strip"
export TOOLCHAIN_PREFIX=$CROSS_CCTOOLS_PATH/bin/x86_64-apple-darwin10-
export DSYMUTIL=$topsrcdir/clang/bin/llvm-dsymutil
export GENISOIMAGE=$topsrcdir/genisoimage/genisoimage
export DMG_TOOL=$topsrcdir/dmg/dmg

export HOST_CC="$topsrcdir/clang/bin/clang"
export HOST_CXX="$topsrcdir/clang/bin/clang++"
export HOST_CPP="$topsrcdir/clang/bin/clang -E"
export HOST_CFLAGS="-g"
export HOST_CXXFLAGS="-g"
export HOST_LDFLAGS="-g"

export MOZ_PACKAGE_JSSHELL=1
export MOZ_PKG_SPECIAL=asan
